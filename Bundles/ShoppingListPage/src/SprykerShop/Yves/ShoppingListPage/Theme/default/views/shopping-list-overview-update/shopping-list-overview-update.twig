{% extends template('page-layout-shopping-list', 'ShoppingListPage') %}

{% define data = {
    title: _view.shoppingList.name,
    form: _view.shoppingListForm,
    shoppingList: _view.shoppingList,
    shoppingListItemProducts: _view.shoppingListItemProducts,
    idShoppingList: _view.shoppingList.idShoppingList | default
} %}

{% block breadcrumbs %}
    {% include molecule('breadcrumb') with {
        data: {
            steps: [{
                label: 'customer.account' | trans,
            },{
                label: 'customer.account.shopping_list' | trans,
            },{
                label: 'customer.account.shopping_list.overview.edit' | trans,
            }]
        }
    } only %}
{% endblock %}

{% block customerNavigation %}
    {{ widgetGlobal('CustomerNavigationWidgetPlugin', 'shoppingList', data.idShoppingList) }}
{% endblock %}

{% block customerContent %}

    {% set hasWritePermission = can('WriteShoppingListPermissionPlugin', data.idShoppingList) %}
    <div class="box">
        {% embed molecule('form') with {
            data: {
                form: data.form,
                shoppingList: data.shoppingList,
                idShoppingList: data.idShoppingList,
                shoppingListItemProducts: data.shoppingListItemProducts,

                submit: {
                    text: 'forms.submit-btn' | trans,
                    class: 'button button--success',
                    icon: null,
                    enable: true,
                    qa: 'submit-button'
                },

                cancel: {
                    text: 'general.back.button' | trans,
                    class: 'button spacing-right',
                    icon: null,
                    url: path('shopping-list'),
                    enable: true,
                    qa: 'back-button'
                }
            }
        } only %}
            {% block fields %}
                <div class="{{config.name}}__field col col--sm-12">
                    {{ form_row(data.form.idShoppingList) }}
                    {{ form_row(data.form.name) }}
                </div>

                <div class="{{config.name}}__field col col--sm-12">
                    {% embed molecule('shopping-list-info', 'ShoppingListPage') with {
                        data: {
                            shoppingList: data.shoppingList
                        }
                    } only %}
                        {% block sharedBlock %}{% endblock %}
                    {% endembed %}
                </div>

                <div class="{{config.name}}__field col col--sm-12">
                    {% if data.shoppingList.items is not empty %}
                        {% include molecule('shopping-list-overview-update-table', 'ShoppingListPage') with {
                            data: {
                                shoppingListItems: data.shoppingList.items,
                                idShoppingList: data.idShoppingList,
                                shoppingList: data.shoppingList,
                                shoppingListItemProducts: data.shoppingListItemProducts,
                                form: data.form
                            }
                        } only %}
                    {% else %}
                        <hr>
                        {{ 'customer.account.shopping_list.empty' | trans }}
                    {% endif %}
                </div>
            {% endblock %}

            {% block actions %}
                <a class="{{config.name}}__action button button--alert spacing-right" href="{{ path('shopping-list/delete/confirm', {idShoppingList: data.idShoppingList}) }}">
                    {{ 'customer.account.shopping_list.overview.delete' | trans }}
                </a>
                {{ parent() }}
            {% endblock %}
        {% endembed %}

    </div>
{% endblock %}
