{% extends template('page-layout-agent', 'AgentPage') %}

{% define data = {
    title: 'quote_request_page.quote_request' | trans,
    quoteRequestForm: _view.quoteRequestForm,
    quoteRequest: _view.quoteRequestForm.vars.value
} %}

{% set cart = data.quoteRequest.quoteInProgress %}

{% block breadcrumbs %}
    {% include molecule('breadcrumb') with {
        data: {
            steps: [
                {
                    label: 'agent.account.page_title' | trans,
                    url: path('agent/overview'),
                },
                {
                    label: 'quote_request_page.quote_request' | trans,
                    url: path('agent/quote-request')
                },
                {
                    label: '#' ~ data.quoteRequest.quoteRequestReference,
                    url: path('agent/quote-request/details', {quoteRequestReference: data.quoteRequest.quoteRequestReference})
                },
                {
                    label: 'quote_request_page.quote_request.actions.edit' | trans,
                }
            ]
        }
    } only %}
{% endblock %}

{% block content %}

    {{ form_start(data.quoteRequestForm) }}

    <div class="grid">
        <div class="col col--sm-12 col--xl-8">
            <div class="box">
                {% for child in data.quoteRequestForm.metadata %}
                    <div class="col col--sm-12 col--xl-6">
                        <div class="box">
                            {{ form_row(child) }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="col col--sm-12 col--xl-4">
            <div class="box">
                <p>{{ 'quote_request_page.quote_request.labels.date' | trans }}:
                    <b>{{ data.quoteRequest.createdAt | date('d.m.Y H:i') }}</b></p>
                <p>{{ 'quote_request_page.quote_request.labels.status' | trans }}:
                    <b>{{ ('quote_request.status.' ~ data.quoteRequest.status) | trans }}</b></p>
                <p>{{ 'quote_request_page.quote_request.labels.valid_till' | trans }}:
                    {{ form_row(data.quoteRequestForm.validUntil) }}
                </p>
                <p>{{ 'quote_request_page.quote_request.labels.history' | trans }}:</p>
                <p>{{ 'quote_request_page.quote_request.labels.visibility' | trans }}:
                    {{ form_row(data.quoteRequestForm.isHidden) }}
                </p>
            </div>
        </div>
    </div>
    <div class="grid">
        <div class="col col--sm-12 col--xl-8">
            {% for itemChild in data.quoteRequestForm.quoteInProgress.items %}
                {% set cartItem = itemChild.vars.value %}
                {% embed molecule('quote-request-cart-item', 'CartPage') with {
                    class: 'box',
                    data: {
                        priceMode: cart.priceMode,
                        cartItem: cartItem,
                        itemChild: itemChild,
                    }
                } only %}
                    {% block sourcePriceForm %}
                        <div class="row">
                            <div class="col col--sm-12 col--xl-4 float-right">
                                {{ form_row(data.itemChild) }}
                            </div>
                            <div class="col col--sm-12 col--xl-12">
                                {% include atom('checkbox') with {
                                    attributes: {
                                        name: 'use_default_price',
                                        value: 1,
                                        checked: (data.cartItem.sourceUnitGrossPrice or data.cartItem.sourceUnitNetPrice) ? false : true,
                                    },
                                    data: {
                                        label: 'quote_request_page.quote_request.use_default_price' | trans
                                    }
                                } only %}
                            </div>
                        </div>
                    {% endblock %}
                {% endembed %}
            {% endfor %}
        </div>

        <div class="col col--sm-12 col--xl-4">
            {% if cart is not empty %}
                <div class="box">
                    {% include molecule('quote-request-cart-summary', 'CartPage') with {
                        data: {
                            cart: cart
                        }
                    } only %}
                </div>
            {% endif %}
            <div class="box">
                <a class="button button--expand button--hollow"
                   href="{{ url('agent/quote-request/details', {quoteRequestReference: data.quoteRequest.quoteRequestReference}) }}">
                    {{ 'quote_request_page.quote_request.actions.back_to_view' | trans }}
                </a>
                <hr/>
                <button type="submit" name="save" class="button button--expand button--success">
                    {{ 'quote_request_page.quote_request.actions.save' | trans }}
                </button>
                <hr/>
                <button type="submit" name="sendToCustomer" class="button button--expand button--success">
                    {{ 'quote_request_page.quote_request.actions.send_to_customer' | trans }}
                </button>
            </div>
        </div>
    </div>

    {{ form_end(data.quoteRequestForm) }}

{% endblock %}
