
{#
 #
 #
 # Component API
 # 
 # @important: use components with 'only' keyword 
 # and limit the scope to what you pass through config and data interface
 #}

{%- set defaultConfig = {
    name: '',
    tag: 'div',
    selector: '',
    debug: false
} -%}

{% block implementation %}
    {%- set config = defaultConfig | merge(config | default({})) -%}
    {%- set config = config | merge({
        selector: config.selector is not empty ? config.selector : (config.name is empty ? defaultConfig.selector : 'js-' ~ config.name)
    }) -%}
    {%- set class = class | default('') -%}
    {%- set modifiers = modifiers | default([]) -%}
    {%- set attributes = attributes | default({}) -%}
    {%- set data = data | default({}) -%}
    {%- set embed = embed | default({}) -%}

    {#
     #
     #
     # Component blocks
     #}

    {%- if config.debug -%}
        {# to use blocks: {{ block('blockname') }} #}

        {# render custom component class #}
        {%- block renderCustomComponentClass -%}
            {%- if config.name == config.tag and '-' in config.tag -%}custom-element {% endif -%}
        {%- endblock -%}

        {# render BEM classes (block and modifiers) according to the name #}
        {%- block renderClass -%}
            {{config.name | trim-}} 
            {%- for modifier in modifiers -%}{%- if modifier | trim is not empty %} {{config.name}}--{{modifier | trim}}{% endif -%}{% endfor -%}
            {%- if class %} {{class-}}{% endif -%}
        {%- endblock -%}

        {# render html5 attributes #}
        {%- block renderAttributes -%}
            {%- for attrname, attrvalue in attributes -%}
                {%- if attrvalue is sameas(true) -%}
                    {{-' ' ~ attrname-}}
                {%- elseif attrvalue is not sameas(false) -%}
                    {{-' ' ~ attrname-}}='{{-attrvalue-}}'
                {%- endif -%}
            {%- endfor -%}
        {%- endblock -%}

        {# render component #}
        {%- block renderComponent -%}
            <{{-config.tag}} 
                class="{{-block('renderCustomComponentClass')-}}{%- block class -%}{{-block('renderClass')-}}{%- endblock -%}"
                {% block attributes -%}{{-block('renderAttributes')-}}{%- endblock -%}>
                {%- block body -%}{%- endblock -%}
            </{{-config.tag-}}>
        {%- endblock -%}
    {%- endif -%}

    {#
     #
     #
     # Component
     #}

    {%- block component -%}
        {{-block('renderComponent')-}}
    {%- endblock -%}
{% endblock -%}
