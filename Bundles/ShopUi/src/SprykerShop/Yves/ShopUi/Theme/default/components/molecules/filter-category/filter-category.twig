{% extends model('component') %}

{% set config = {
    name: 'filter-category' 
} | merge(config | default({})) %}

{% set data = {
    filter: data.filter | default(null),
    filterPath: data.filterPath | default(null),
    categories: data.categories | default([])
} | merge(data | default({})) %}

{% block body %}
    {% if data.categories is not empty %}
        <ul class="menu">
            {% for categoryNode in data.categories %}
                {% set quantity = 0 %}
                {% set hasChildren = categoryNode.children is defined and categoryNode.children is not empty %}

                {% for filterValue in data.filter.values if (filterValue.value == categoryNode.nodeId) %}
                    {% set quantity = filterValue.docCount %}
                {% endfor %}

                {% if data.filterPath is not empty %}
                    {% set categoryUrl = url(data.filterPath, {categoryPath: (categoryNode.url)}) %}
                {% else %}
                    {% set categoryUrl = categoryNode.url | replace({"'": "\\'", '"':'\\"'}) %}
                {% endif %}

                <li class="menu__item {% if hasChildren %}menu__item--has-children-list{% endif %}">
                    <button class="link" onclick="this.form.action='{{ categoryUrl }}'" {% if quantity == 0 %}disabled="disabled"{% endif %}>
                        {{ categoryNode.name }} ({{ quantity }})
                    </button>

                    {% if hasChildren %}
                        {% include molecule('filter-category') with {
                            data: {
                                filter: data.filter,
                                filterPath: data.filterPath,
                                categories: categoryNode.children
                            }
                        } only %}
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}


